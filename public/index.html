<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>云南行无忧客户数据分析</title>
    <link rel="stylesheet" type="text/css" href="./styles/iview.css">
    <script type="text/javascript" src="./vue.min.js"></script>
    <script type="text/javascript" src="./iview.min.js"></script>
    <script type="text/javascript" src="./axios.min.js"></script>
</head>

<body style="padding:10px;margin:10px">
    <div id="app">
        <div style="display: flex;width: 800px">
        <Upload multiple type="drag" action="./upload" name="excel" :on-success="uploadSuccess">
            <div style="padding: 20px 0">
                <Icon type="ios-cloud-upload" size="52" style="color: #3399ff"></Icon>
                <p>{{text1}}</p>
            </div>
        </Upload>
        <Upload multiple type="drag" action="./upload" name="excel2" :on-success="uploadSuccess2">
            <div style="padding: 20px 0">
                <Icon type="ios-cloud-upload" size="52" style="color: #3399ff"></Icon>
                <p>{{text2}}</p>
            </div>
        </Upload>
        </div>
        <Tag v-for="item in tags" :key="item[1]" :name="item" closable @on-close="handleClose2">{{ item[1] }}</Tag>
        <i-button @click="show">查看数据</i-button>
        <div v-for="(buttons, index) in buttonss" :key="buttons" v-show="!visible[index]"
            style="display:flex;align-items:baseline;height:25px;">
            <span style="font-weight: bolder">{{buttons.title}}：</span>
            <div>
                <i-button v-for="item in buttons.buttons" :key="item" type="text" @click="handleAddTag(item, index)">{{item}}</i-button>
            </div>
        </div>
        <div style="height:10px"></div>
        <i-table :columns="columns10" :data="data10" width="100%" height="300"></i-table>
        <div style="height:10px"></div>
        <Page :total="totalColumns" @on-change="handlePageChange"></Page>
    </div>

    <script>
        let totalColumns = 0;

        new Vue({
            el: '#app',
            data: {
                totalColumns: 0,
                visible: [],
                text1: "请点击或把<<维修进场excel报表>>文件拖到这里。。。",
                text2: "请点击或把<<销售基盘excel报表>>文件拖到这里。。。",
                columns10: [{
                        title: '用户姓名',
                        key: '用户姓名',
                        width: 100,
                        fixed: "left"
                    },
                    {
                        title: '用户手机',
                        key: '用户手机',
                        width: 150
                    },
                    {
                        title: '车牌号',
                        key: '车牌号',
                        width: 100
                    },
                    {
                        title: '维修类型',
                        key: '维修类型',
                        width: 150
                    },
                    {
                        title: '车系',
                        key: '车系',
                        width: 100
                    },
                    {
                        title: '行驶里程',
                        key: '行驶里程',
                        width: 100
                    },
                    {
                        title: '实际应付金额',
                        key: '实际应付金额',
                        width: 150
                    },
                    {
                        title: '结算属性',
                        key: '结算属性',
                        width: 150
                    }
                ],
                data10: [],
                tags: [], // [[0, "三个月未进厂"], [1, "女性"], [2, "昂克赛拉"]],\
                buttonss: [{
                        title: "行驶里程(公里)",
                        buttons: ["0-5000", "5000-10000", "10000-50000", ">50000"]
                    }, {
                        title: "车系",
                        buttons: ["CX-5", "Axela", "马自达2"]
                    },
                    {
                        title: "维修类型",
                        buttons: ["索赔", "保养", "首保"]
                    },
                    {
                        title: "结算属性",
                        buttons: ["索赔结算", "客户自费", "保险公司付费"]
                    }
                ]
            },
            methods: {
                handlePageChange: function (page) {
                    console.log(page)
                    let c = totalColumns.concat();
                    this.data10 = c.splice((page - 1) * 10, 10);
                },
                handleAddTag: function (tag, index) {
                    console.log(tag, " ", index);
                    this.tags.push([index, tag]);
                    this.visible[index] = true;
                    this.show();
                },
                show: function () {
                    axios.get('./get-table', {
                        params: {
                            tags: this.tags
                        }
                    }).then(res => {
                        //console.log(res.data.length);
                        totalColumns = res.data.concat();
                        this.totalColumns = totalColumns.length;
                        this.data10 = res.data.splice(0, 10);
                    })
                },
                uploadSuccess: function (response, file, fileList) {
                    console.log(response);
                    this.text1 = "文件上传成功";
                },
                uploadSuccess2: function (response, file, fileList) {
                    console.log(response);
                    this.text1 = "文件上传成功";
                },
                handleClose2(event, tag) {
                    console.log(tag);
                    const index = this.tags.indexOf(tag);
                    this.tags.splice(index, 1);
                    this.visible[tag[0]] = false;
                    this.show();
                }
            }
        })
    </script>

    <style>
        .aaa {
            padding: 0px;
            margin: 20px;
            height: 25px;
            width: 500px;
            border: 1px;
        }
    </style>
</body>

</html>